$(function(){function r(){$("form.login p.error, form.registration p.error").remove(),$("form.login input, form.registration input").removeClass("error")}var t=!0;$(".switch-button").on("click",function(o){o.preventDefault(),$("input").val(""),r(),$("input").removeClass("error"),t?(t=!1,$(".registration").show("slow"),$(".login").hide()):(t=!0,$(".login").show("slow"),$(".registration").hide())}),$("form.login input, form.registration input").on("focus",function(){r()}),$(".registration-button").on("click",function(o){o.preventDefault(),r(),$("input").removeClass("error");var t={login:$("#registration-login").val(),password:$("#registration-password").val(),passwordConfirm:$("#registration-password-confirm").val()};$.ajax({type:"Post",data:JSON.stringify(t),contentType:"application/json",url:"/api/auth/register"}).done(function(o){o.ok?$(location).attr("href","/"):($(".registration h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach(function(o){$("input[name="+o+"]").addClass("error")}))})}),$(".login-button").on("click",function(o){o.preventDefault(),r(),$("input").removeClass("error");var t={login:$("#login-login").val(),password:$("#login-password").val()};$.ajax({type:"Post",data:JSON.stringify(t),contentType:"application/json",url:"/api/auth/login"}).done(function(o){o.ok?$(location).attr("href","/"):($(".login h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach(function(o){$("input[name="+o+"]").addClass("error")}))})})}),$(function(){function n(){$(".post-form p.error").remove(),$(".post-form input, #post-body").removeClass("error")}$(".post-form input, #post-body").on("focus",function(){n()}),$(".publish-button, .save-button").on("click",function(o){o.preventDefault(),n();var t="save-button"===$(this).attr("class").split(" ")[0],r={title:$("#post-title").val(),body:$("#post-body").val(),isDraft:t,postId:$("#post-id").val()};$.ajax({type:"POST",data:JSON.stringify(r),contentType:"application/json",url:"/post/add"}).done(function(o){o.ok?t?$(location).attr("href","/post/edit/"+o.post.id):$(location).attr("href","/posts/"+o.post.url):($(".post-form h2").after('<p class="error">'+o.error+"</p>"),o.fields&&o.fields.forEach(function(o){$("#post-"+o).addClass("error")}))})}),$("#fileinfo").on("submit",function(o){o.preventDefault();var t=new FormData(this);$.ajax({type:"Post",url:"/upload/image",data:t,processData:!1,contentType:!1,success:function(o){console.log(o)},error:function(o){console.log(o)}})})}),$(function(){var r,n;$("#new, #reply").on("click",function(){if(n=null,r&&r.remove(),r=$(".comment").clone(!0,!0),"new"===$(this).attr("id"))r.appendTo(".comment-list");else{var o=$(this).parent();n=o.attr("id"),$(this).after(r)}r.css({display:"flex"})}),$("form.comment .cancel").on("click",function(o){o.preventDefault(),r.remove()}),$("form.comment .send").on("click",function(o){o.preventDefault();var t={post:$(".comments").attr("id"),body:r.find("textarea").val(),parent:n};$.ajax({type:"POST",data:JSON.stringify(t),contentType:"application/json",url:"/comment/add"}).done(function(o){if(o.ok){var t='<ul><li><div class="head"><a href="/users/'+o.login+'">'+o.login+'</a><span class="date"></span></div>'+o.body+'<span class="link" id="reply">Answer</span></li></ul>';$(r).after(t),r.remove()}else void 0===o.error&&(o.error="Unknown error"),$(r).prepend('<p class="error">'+o.error+"</p>")})})}),$("textarea").each(function(){this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")}).on("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"});