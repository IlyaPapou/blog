$(function(){function e(){$("form.login p.error, form.registration p.error").remove(),$("form.login input, form.registration input").removeClass("error")}var o=!0;$(".switch-button").on("click",function(t){t.preventDefault(),$("input").val(""),e(),$("input").removeClass("error"),o?(o=!1,$(".registration").show("slow"),$(".login").hide()):(o=!0,$(".login").show("slow"),$(".registration").hide())}),$("form.login input, form.registration input").on("focus",function(){e()}),$(".registration-button").on("click",function(t){t.preventDefault(),e(),$("input").removeClass("error");var o={login:$("#registration-login").val(),password:$("#registration-password").val(),passwordConfirm:$("#registration-password-confirm").val()};$.ajax({type:"Post",data:JSON.stringify(o),contentType:"application/json",url:"/api/auth/register"}).done(function(t){t.ok?$(location).attr("href","/"):($(".registration h2").after('<p class="error">'+t.error+"</p>"),t.fields&&t.fields.forEach(function(t){$("input[name="+t+"]").addClass("error")}))})}),$(".login-button").on("click",function(t){t.preventDefault(),e(),$("input").removeClass("error");var o={login:$("#login-login").val(),password:$("#login-password").val()};$.ajax({type:"Post",data:JSON.stringify(o),contentType:"application/json",url:"/api/auth/login"}).done(function(t){t.ok?$(location).attr("href","/"):($(".login h2").after('<p class="error">'+t.error+"</p>"),t.fields&&t.fields.forEach(function(t){$("input[name="+t+"]").addClass("error")}))})})}),$(function(){function n(){$(".post-form p.error").remove(),$(".post-form input, #post-body").removeClass("error")}$(".post-form input, #post-body").on("focus",function(){n()}),$(".publish-button, .save-button").on("click",function(t){t.preventDefault(),n();var o="save-button"===$(this).attr("class").split(" ")[0],e={title:$("#post-title").val(),body:$("#post-body").val(),isDraft:o,postId:$("#post-id").val()};$.ajax({type:"POST",data:JSON.stringify(e),contentType:"application/json",url:"/post/add"}).done(function(t){t.ok?o?$(location).attr("href","/post/edit/"+t.post.id):$(location).attr("href","/posts/"+t.post.url):($(".post-form h2").after('<p class="error">'+t.error+"</p>"),t.fields&&t.fields.forEach(function(t){$("#post-"+t).addClass("error")}))})}),$("#file").on("change",function(t){t.preventDefault();$("#post-title").val(),$("#post-body").val();var o=new FormData;o.append("postId",$("#post-id").val()),o.append("file",$("#file")[0].files[0]),$.ajax({type:"POST",url:"/upload/image",data:o,processData:!1,contentType:!1,success:function(t){$("#fileinfo").prepend('<div class="img-container"><img src="/uploads'+t.filePath+'" alt="Super image!"></div>'),location.reload(!1)},error:function(t){console.log(t)}})}),$(".img-container").on("click",function(){var t=$(this).attr("id"),o=$("#post-body"),e=o[0].selectionStart,n=o.val(),r="![alt text](image"+t+")";o.val(n.substring(0,e)+r+n.substring(e))})}),$(function(){var e,n;$("#new, #reply").on("click",function(){if(n=null,e&&e.remove(),e=$(".comment").clone(!0,!0),"new"===$(this).attr("id"))e.appendTo(".comment-list");else{var t=$(this).parent();n=t.attr("id"),$(this).after(e)}e.css({display:"flex"})}),$("form.comment .cancel").on("click",function(t){t.preventDefault(),e.remove()}),$("form.comment .send").on("click",function(t){t.preventDefault();var o={post:$(".comments").attr("id"),body:e.find("textarea").val(),parent:n};$.ajax({type:"POST",data:JSON.stringify(o),contentType:"application/json",url:"/comment/add"}).done(function(t){if(t.ok){var o='<ul><li><div class="head"><a href="/users/'+t.login+'">'+t.login+'</a><span class="date"></span></div>'+t.body+'<span class="link" id="reply">Answer</span></li></ul>';$(e).after(o),e.remove(),location.reload()}else void 0===t.error&&(t.error="Unknown error"),$(e).prepend('<p class="error">'+t.error+"</p>")})})}),$("textarea").each(function(){this.setAttribute("style","height:"+this.scrollHeight+"px;overflow-y:hidden;")}).on("input",function(){this.style.height="auto",this.style.height=this.scrollHeight+"px"}),function(t){var o=void 0!==window.localStorage;function e(t,o){var e,n,r;if((e=new Date).setTime(e.getTime()+31536e6),n="; expires="+e.toGMTString(),"string"==typeof t&&"string"==typeof o)return document.cookie=t+"="+o+n+"; path=/",!0;if("object"==typeof t&&void 0===o){for(r in t)t.hasOwnProperty(r)&&(document.cookie=r+"="+t[r]+n+"; path=/");return!0}return!1}t.extend({Storage:{set:o?function(t,o){var e;if("string"==typeof t&&"string"==typeof o)return localStorage[t]=o,!0;if("object"==typeof t&&void 0===o){for(e in t)t.hasOwnProperty(e)&&(localStorage[e]=t[e]);return!0}return!1}:e,get:o?function(t){return localStorage[t]}:function(t){var o,e,n,r;for(o=t+"=",e=document.cookie.split(";"),n=0;n<e.length;n++){for(r=e[n];" "===r.charAt(0);)r=r.substring(1,r.length);if(0===r.indexOf(o))return r.substring(o.length,r.length)}return null},remove:o?function(t){return delete localStorage[t]}:function(t){return e(t,"")}}})}(jQuery),function(){var o,e;$(".ntSaveForms").each(function(t){e="ntSaveForms"+t,$(this).addClass(e),(o=$.Storage.get(e))&&0<o.length&&!$(this).val()&&$(this).val(o)}),$(".ntSaveForms").keyup(function(){$.Storage.set($(this).attr("class").split(" ")[$(this).attr("class").split(" ").length-1],$(this).val())}),$(".ntSaveFormsSubmit").click(function(){$(".ntSaveForms").each(function(t){$.Storage.remove("ntSaveForms"+t)})})}();